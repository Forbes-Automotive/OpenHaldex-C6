name: Discord Git Feed

on:
  push:
    branches: [ "develop", "main" ]

  pull_request:
    branches: [ "develop", "main" ]
    types: [ opened, reopened, synchronize, ready_for_review, closed ]

permissions:
  contents: read

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      # PUSH (commits pushed or merge commits landing on develop/main)
      - name: Discord - Push
        if: github.event_name == 'push'
        uses: rjstone/discord-webhook-notify@v2
        with:
          webhookUrl: ${{ secrets.DISCORD_WEBHOOK }}
          username: Forbes Automotive â€¢ GitHub
          text: |
            âœ… **Push to `${{ github.ref_name }}`** by **${{ github.actor }}**
            â€¢ Repo: **${{ github.repository }}**
            â€¢ Compare: ${{ github.event.compare }}

      # PR opened/updated (includes new commits on the PR via "synchronize")
      - name: Discord - PR Open/Update
        if: github.event_name == 'pull_request' && github.event.action != 'closed'
        uses: rjstone/discord-webhook-notify@v2
        with:
          webhookUrl: ${{ secrets.DISCORD_WEBHOOK }}
          username: Forbes Automotive â€¢ GitHub
          text: |
            ðŸ§µ **PR ${{ github.event.action }} â†’ `${{ github.base_ref }}`**
            **#${{ github.event.pull_request.number }}: ${{ github.event.pull_request.title }}**
            â€¢ Author: **${{ github.event.pull_request.user.login }}**
            â€¢ Branch: `${{ github.head_ref }}` â†’ `${{ github.base_ref }}`
            â€¢ Link: ${{ github.event.pull_request.html_url }}

      # PR merged (closed + merged=true) â€” this is your explicit "merge" ping
      - name: Discord - PR Merged
        if: github.event_name == 'pull_request' && github.event.action == 'closed' && github.event.pull_request.merged == true
        uses: rjstone/discord-webhook-notify@v2
        with:
          webhookUrl: ${{ secrets.DISCORD_WEBHOOK }}
          username: Forbes Automotive â€¢ GitHub
          text: |
            ðŸŽ‰ **PR merged into `${{ github.base_ref }}`**
            **#${{ github.event.pull_request.number }}: ${{ github.event.pull_request.title }}**
            â€¢ Merged by: **${{ github.actor }}**
            â€¢ Link: ${{ github.event.pull_request.html_url }}
